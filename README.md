# 公開資訊觀測站 - 關鍵字搜尋

本專案為一個自動化爬蟲工具，用以擷取來自 [公開資訊觀測站 (MOPS)](https://mops.twse.com.tw/) 相關公告資料。目前以的「總經理異動」為範例，並且可以透過替關鍵字，抓取其他相關資料。
本專案透過 Selenium 模擬操作瀏覽器介面，自動化查詢不同市場（上市、上櫃）在指定年度內的關鍵詞公告資料，並深入點擊「詳細資料」頁面，爬取更完整之背景資訊，最終整理並匯出為 CSV 檔案。

## 📁 專案結構

| 檔案名稱               | 說明                                       |
|------------------------|--------------------------------------------|
| `CEO_change.py`        | 主爬蟲邏輯：自動操作表單、查詢、分頁與下載資料 |
| `detail_button.py`     | 負責解析每一筆異動資料的「詳細資料」頁面     |
| `CEOchange_clear.ipynb`| 開發與測試用的 Jupyter 筆記本               |
| `requirements.txt`     | 所需安裝的 Python 套件清單                  |

---

## 🔧 安裝與執行方式

1. 安裝必要套件：

```bash
pip install -r requirements.txt
```

2. 確保已安裝 [Google Chrome](https://www.google.com/chrome/) 瀏覽器與對應版本的 [ChromeDriver](https://sites.google.com/chromium.org/driver/)。 [For versions 115 and newer](<https://googlechromelabs.github.io/chrome-for-testing/>)
3.

確保已安裝 Google Chrome 瀏覽器與對應版本的 ChromeDriver，並可透過環境變數存取。
3.
執行主程式：

```bash
python CEO_change.py
```

執行後，資料將依「公司市場別」與「關鍵字」自動查詢並匯出至 ./Data 資料夾下。

## ⚠️ 注意事項與風險警告

> ❗ **請使用者務必詳讀以下警告，以避免對網站造成負擔或違反相關法規：**

### 🚫 IP 封鎖風險

本程式涉及大量查詢與分頁點擊，若執行頻率過高，MOPS 官方網站可能返回「查詢過於頻繁」的提示，甚至導致 IP 被暫時封鎖。  
程式中雖已設置隨機延遲（`random.uniform`）機制以降低風險，但仍請避免密集反覆執行，並務必尊重網站流量限制。

---

### 🧪 資料正確性限制

公開資訊觀測站的網頁結構（如 HTML DOM 元素、查詢參數）可能會不定期更新。  
若結構異動，程式可能會失效或誤抓資料，請使用者定期檢查與維護本程式的有效性與準確性。

---

## 📜 使用條款

本工具 **僅供學術研究或個人學習使用**，請勿將其用於商業性重度爬取或大量自動化操作。  
請確保您的使用行為未違反 [公開資訊觀測站使用條款](https://www.twse.com.tw/zh/products/information/qa.html)，尊重原始資料提供者之合法權利，對於一切行為，使用者需自付一切法律責任。

---

## 🔍 可自訂參數

使用者可於 `CEO_change.py` 檔案中，透過調整下列參數，靈活控制查詢的條件與輸出結果：

| 參數名稱         | 說明                                                         | 範例                          |
|------------------|--------------------------------------------------------------|-------------------------------|
| `cond_firm_type` | 公司類型，可選擇 `"上市公司"`、`"上櫃公司"`、`"興櫃公司"` 等 | `"上市公司"`                  |
| `year_timing`    | 查詢年度（使用民國年格式）                                   | `113`（對應西元 2024 年）  |
| `month_timing`   | 查詢月份，可指定如 `"01"` 或使用 `"全年度"` 作為預設         | `"全年度"`                    |
| `keyWord`        | 主查詢關鍵字，限定資料主題                                   | `"總經理異動"`、`"總經理變動"` 等 |
| `condition2`     | 第二條件的邏輯選項，包含 `"且含"`、`"或含"`、`"不含"`         | `"不含"`                      |
| `second_keyWord` | 第二條件的排除或擴展關鍵字，用於更細緻的篩選                 | `"副總經理"`                  |

### 📌 範例組合

可改動以下參數以符合您的需求：

```python
# 設定參數
# 欲爬取的公司類型
cond_firm_type_list = ["上市公司", "上櫃公司"]  # "興櫃公司" "公開發行公司"
# 欲爬取的時間區間
year_timing = [
    str(i) for i in range(113, 114)
]  # range 中為時間區間，為113年到114年
# 設定月份
month_timing = "全年度"
# 頁面顯示筆數
PCount = "100"
# 設定關鍵字
keyWords = [
    "總經理異動",
    "任總經理",
    "總經理變動",
    "總經理聘任",
    "總經理人事",
]
# 第二條件
condition2 = "不含"  # "且含" "或含" "不含"
# 第二關鍵字
second_keyWord = "副總經理"

```
